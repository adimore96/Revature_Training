-- MySQL Exercise

-- 1. Create a database named sales_db.
create database sales_db;
use sales_db;

-- 2. Create a table customers with columns: customer_id, name, email, phone
create table customers(customer_id int, name varchar(255), phone int);

-- 3. Add a PRIMARY KEY to customer_id.
alter table customers modify customer_id int primary key;

alter table customers add column email varchar(255);

-- 4. Add a UNIQUE constraint to email
alter table customers modify email varchar(255) unique;
desc customers;

-- 5. Add a column created_at with DEFAULT CURRENT_TIMESTAMP.
alter table customers add column created_at datetime default current_timestamp;
desc customers;

-- 6. Create a table orders with FOREIGN KEY referencing customers.
create table orders(order_id int primary key, customer_id int not null, order_date date, 
foreign key(customer_id) references customers(customer_id));
desc orders;

-- 7. Create a table employees with CHECK constraint: salary > 0.
create table employees(emp_id int primary key auto_increment, f_name varchar(255), last_name varchar(255), 
email varchar(255) unique not null, salary int check(salary>0), department_id int);
desc employees;

insert into employees values(0, "Aditya", "More", "aditya@gmail.com", 95000,101);
select * from employees;

-- 8. Add AUTO_INCREMENT to customer_id.
desc customers;
-- since we has use the customer_id (pk) for orders reference first we have to 
-- drop the foreign key from orders and modify customer_id in customers table.alter
-- SHOW CREATE TABLE orders;
alter table orders drop foreign key orders_ibfk_1;
desc orders;
alter table customers modify customer_id int auto_increment;
desc customers;
-- now add foregin key back in orders table
alter table orders add constraint foreign key(customer_id) references customers(customer_id);
SHOW CREATE TABLE orders;

-- 9. Drop the column phone from customers.
desc customers;
alter table customers drop column phone;
desc customers;

-- 10. Truncate the orders table.
select * from orders;
truncate table orders;
select * from orders;

-- 11. Drop the table orders.
desc orders;
drop table orders;
desc orders;

-- 12. Rename table customers to client_master.
desc customers;
alter table customers rename to client_master;
desc client_master;

-- 13. Create a table products with price having DEFAULT 0.
create table products(product_id int primary key auto_increment, product_name varchar(255) not null,added_date date, price int default(0));
desc products;
insert into products(product_name, added_date) values("Acer Laptop", "2026-01-12");
select * from products;

-- first check if data delets from the customers table since orders uses the reference key from customers
select * from client_master;


-- 14. Add CASCADE DELETE rule between orders and client_master.
create table orders(order_id int primary key auto_increment, product_name varchar(255), customer_id int, 
foreign key (customer_id) references client_master(customer_id) on delete cascade);
show create table  orders;

-- 15. Show all tables in sales_db.
show tables;

-- 16. Insert 5 records into client_master.
desc client_master;
insert into client_master(name, email) values("Aditya","aditya@gmail.com"),("Raj","raj@gmail.com"),("Karan","karan@gmail.com"),
("Shiv","shiv@gmail.com"),("Dev","dev@gmail.com");
select * from client_master;

-- 17. Insert multiple rows into products in one query.
desc products;
insert into products(product_name, added_date) values("Acer Laptop","2026-01-12"),("Lanovo Tablet","2026-01-13");
select * from products;

-- 18. Update salary of employee id = 101.
select * from employees;
update employees set salary = 98500 where emp_id = 1;

-- 19. Increase product price by 10%.
select * from products;
update products set price = ((price/100)*10)+price;

-- 20. Delete a customer whose id = 10.
select * from client_master;
delete from client_master where customer_id = 5;

-- 21. Delete all inactive customers.
delete from client_master where isactive = false;

-- 22. Insert a new order for customer id = 3.
select * from orders;
insert into orders values(1,"Acer Laptop", 3);

-- 23. Update order status to SHIPPED.
desc orders;
alter table orders add column order_status varchar(255) default("Packaging") after product_name;
update orders set order_status = "SHIPPED" where order_id = 1;
select * from orders;

-- 24. Delete orders older than 2022.
alter table orders add column order_date date;
update orders set order_date = "2026-01-12" where order_id=1;
insert into orders(product_name, customer_id,order_date) values("Hp Laptop",1,"2021-12-23"),("Acer Laptop",2,"2023-12-23");
delete from orders where year(order_date) < 2022;
select * from orders;

-- 25. Copy data from client_master to backup_customers.
create table backup_customers as select * from client_master;
select * from backup_customers;

-- 26. Display all customers.
select * from client_master;

-- 27. Display only name and email of customers.
select name, email from client_master;

-- 28. Find all employees with salary > 50000.
select * from employees where salary > 50000;

-- 29. List products ordered by price DESC.
select * from products order by price desc;

-- 30. Show distinct cities from customers.
select  distinct city from client_master;

-- 31. Count total number of customers.
select count(customer_id) as TOTAL_CUSTOMER from client_master;

-- 32. Find average salary of employees.
insert into employees(f_name, last_name, email, salary, department_id) values("Raj","More","raj@gmail.com",95000,102);
select avg(salary) as AVG_SALARY from employees;
select * from employees;

-- 33. Find maximum product price.
select max(price) from products;

-- 34. Find minimum order amount.
select min(totalCost) from orders;

-- 35. Calculate total sales amount.
select sum(totalCost) from orders;

-- 36. Show department-wise employee count.
select count(department_id), department_id from employees group by department_id;
insert into employees(f_name, last_name, email, salary, department_id) values("Dev","Moser","dev@gmail.com",93000,101);
select * from employees;

-- 37. Show department-wise average salary.
select avg(salary) as AVG_SALARY, department_id as DEPT_ID from employees group by department_id;

-- 38. Display only departments having more than 5 employees.
select department_id from employees group by department_id having count(department_id)>=5;

-- 39. Find total sales per customer
select count(o.order_id) as TOTAL_SALES, o.customer_id as Customer_ID, cm.name as CUSTOMER_NAME from orders o 
join client_master cm on cm.customer_id=o.customer_id  group by customer_id;

-- 40. Find total revenue per month.
select YEAR(order_date) AS year, MONTH(order_date) AS month, sum(order_id) as MONTH_REVENUE 
from orders group by year(order_date), month(order_date) order by  year, month;
select * from orders;

-- 41. List employees who joined after 2021.
update client_master set created_at = "2026-01-20 00:16:27" where customer_id = 4;
select * from client_master;
select * from client_master where year(created_at) > 2021;

-- 42. Show orders between two dates.
select * from orders where order_date between "2023-12-20" and "2026-01-13"  ;
select * from orders;

-- 43. Find customers from Delhi.
select * from client_master where lower(location) like "delhi";

-- 44. Sort employees by salary ASC
select * from employees order by salary asc;

-- 45. Display top 5 highest paid employees.
select * from employees order by salary desc limit 5;