-- MySQL Exercise

-- 1. Create a database named sales_db.
create database sales_db;
use sales_db;

-- 2. Create a table customers with columns: customer_id, name, email, phone
create table customers(customer_id int, name varchar(255), phone int);

-- 3. Add a PRIMARY KEY to customer_id.
alter table customers modify customer_id int primary key;

alter table customers add column email varchar(255);

-- 4. Add a UNIQUE constraint to email
alter table customers modify email varchar(255) unique;
desc customers;

-- 5. Add a column created_at with DEFAULT CURRENT_TIMESTAMP.
alter table customers add column created_at datetime default current_timestamp;
desc customers;

-- 6. Create a table orders with FOREIGN KEY referencing customers.
create table orders(order_id int primary key, customer_id int not null, order_date date, 
foreign key(customer_id) references customers(customer_id));
desc orders;

-- 7. Create a table employees with CHECK constraint: salary > 0.
create table employees(emp_id int primary key auto_increment, f_name varchar(255), last_name varchar(255), 
email varchar(255) unique not null, salary int check(salary>0), department_id int);
desc employees;

insert into employees values(0, "Aditya", "More", "aditya@gmail.com", 95000,101);
select * from employees;

-- 8. Add AUTO_INCREMENT to customer_id.
desc customers;
-- since we has use the customer_id (pk) for orders reference first we have to 
-- drop the foreign key from orders and modify customer_id in customers table.alter
-- SHOW CREATE TABLE orders;
alter table orders drop foreign key orders_ibfk_1;
desc orders;
alter table customers modify customer_id int auto_increment;
desc customers;
-- now add foregin key back in orders table
alter table orders add constraint foreign key(customer_id) references customers(customer_id);
SHOW CREATE TABLE orders;

-- 9. Drop the column phone from customers.
desc customers;
alter table customers drop column phone;
desc customers;

-- 10. Truncate the orders table.
select * from orders;
truncate table orders;
select * from orders;

-- 11. Drop the table orders.
desc orders;
drop table orders;
desc orders;

-- 12. Rename table customers to client_master.
desc customers;
alter table customers rename to client_master;
desc client_master;

-- 13. Create a table products with price having DEFAULT 0.
create table products(product_id int primary key auto_increment, product_name varchar(255) not null,added_date date, price int default(0));
desc products;
insert into products(product_name, added_date) values("Acer Laptop", "2026-01-12");
select * from products;

-- first check if data delets from the customers table since orders uses the reference key from customers
select * from client_master;


-- 14. Add CASCADE DELETE rule between orders and client_master.
create table orders(order_id int primary key auto_increment, product_name varchar(255), customer_id int, 
foreign key (customer_id) references client_master(customer_id) on delete cascade);
show create table  orders;

-- 15. Show all tables in sales_db.
show tables;

-- 16. Insert 5 records into client_master.
desc client_master;
insert into client_master(name, email) values("Aditya","aditya@gmail.com"),("Raj","raj@gmail.com"),("Karan","karan@gmail.com"),
("Shiv","shiv@gmail.com"),("Dev","dev@gmail.com");
select * from client_master;

-- 17. Insert multiple rows into products in one query.
desc products;
insert into products(product_name, added_date) values("Acer Laptop","2026-01-12"),("Lanovo Tablet","2026-01-13");
select * from products;

-- 18. Update salary of employee id = 101.
select * from employees;
update employees set salary = 98500 where emp_id = 1;

-- 19. Increase product price by 10%.
select * from products;
update products set price = ((price/100)*10)+price;

-- 20. Delete a customer whose id = 10.
select * from client_master;
delete from client_master where customer_id = 5;

-- 21. Delete all inactive customers.
delete from client_master where isactive = false;

-- 22. Insert a new order for customer id = 3.
select * from orders;
insert into orders values(1,"Acer Laptop", 3);

-- 23. Update order status to SHIPPED.
desc orders;
alter table orders add column order_status varchar(255) default("Packaging") after product_name;
update orders set order_status = "SHIPPED" where order_id = 1;
select * from orders;

-- 24. Delete orders older than 2022.
alter table orders add column order_date date;
update orders set order_date = "2026-01-12" where order_id=1;
insert into orders(product_name, customer_id,order_date) values("Hp Laptop",1,"2021-12-23"),("Acer Laptop",2,"2023-12-23");
delete from orders where year(order_date) < 2022;
select * from orders;

-- 25. Copy data from client_master to backup_customers.
create table backup_customers as select * from client_master;
select * from backup_customers;

